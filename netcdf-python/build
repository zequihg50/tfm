set -e

PREFIX='/home/zequi/tfm/sw'

# Do this manual
#wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
#chmod a+x Miniconda3-latest-Linux-x86_64.sh
#./Miniconda3-latest-Linux-x86_64.sh
#source ~/.bashrc
#~/miniconda3/bin/conda create -n tfm -y
#~/miniconda3/bin/conda activate tfm

#yum install -y python36 python36-pip python36-devel
if [ ! -d "netcdf4-python" ]; then
	git clone https://github.com/Unidata/netcdf4-python
fi
cd netcdf4-python
#git checkout v1.4.3.2
export PATH=$PREFIX/bin:$PATH # nc-config
conda activate tfm
#sudo pip3 install numpy cython
 HDF5_DIR="$PREFIX" HDF5_INCDIR="$PREFIX/include" HDF5_LIBDIR="$PREFIX/lib" NETCDF4_DIR="$PREFIX" NETCDF4_INCDIR="$PREFIX/include" NETCDF4_LIBDIR="$PREFIX/lib" python3 setup.py build
HDF5_DIR="$PREFIX" HDF5_INCDIR="$PREFIX/include" HDF5_LIBDIR="$PREFIX/lib" NETCDF4_DIR="$PREFIX" NETCDF4_INCDIR="$PREFIX/include" NETCDF4_LIBDIR="$PREFIX/lib" sudo -E python3 setup.py install
cd test
python3 run_all.py
